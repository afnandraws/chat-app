(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2677:function(e,t,n){Promise.resolve().then(n.bind(n,5857))},5857:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var s=n(7437),o=n(1192),a=n.n(o);n(364);var r=n(2265),i=n(3388);n(7510);var l={src:"/_next/static/media/send.ee18181b.svg",height:800,width:800,blurWidth:0,blurHeight:0},c={src:"/_next/static/media/users.c394b506.svg",height:800,width:800,blurWidth:0,blurHeight:0},m=n(6691),u=n.n(m),d=n(7868);let g=new d.default("myDatabase");g.version(1).stores({messages:"++id, room, socketID, message, time, username"}),n(7398);let h=Date.now();new Date(h-6e4).toLocaleTimeString();let f=new Date(h-3e5).toLocaleTimeString();new Date(h-72e5).toLocaleTimeString();var j=e=>{let{socket:t,userID:n,username:o,firstMessage:a,userList:i}=e,[m,d]=(0,r.useState)([]),[h,j]=(0,r.useState)(""),[v,x]=(0,r.useState)(!1),p=localStorage.getItem("room"),_=(0,r.useRef)();async function b(e){("Enter"===e.key&&h||"click"===e.type&&h)&&(d([...m,{message:h,room:p,time:new Date().toLocaleTimeString("en-UK",{hour:"2-digit",minute:"2-digit"}),username:o}]),t.emit("send_message",{message:h,room:p,username:o}),j(""),await g.messages.add({room:p,socketID:n,message:h,time:new Date().toLocaleTimeString("en-UK",{hour:"2-digit",minute:"2-digit"}),username:o}))}return(0,r.useEffect)(()=>(null==t||t.on("receive_message",e=>{d(t=>[...t,e])}),null==t||t.on("sent_message",e=>{console.log(e)}),()=>{null==t||t.disconnect()}),[t]),(0,r.useEffect)(()=>{_.current.scrollTop=_.current.scrollHeight},[m]),(0,r.useEffect)(()=>{async function e(){await g.messages.where("time").below(f).delete().then(function(e){console.log("Deleted "+e+" objects")})}a&&(d([...m,{message:a,room:p,time:new Date().toLocaleTimeString("en-UK",{hour:"2-digit",minute:"2-digit"}),username:o}]),t.emit("send_message",{message:a,room:p,username:o})),async function(){let e=await g.messages.where("time").above(f).and(e=>e.room===p).toArray();if(e){for(let t of e)t.username===o&&console.log(t);console.log(e)}}(),e()},[]),(0,s.jsxs)("div",{className:"chatcontainer",children:[(0,s.jsxs)("div",{className:"chatheader",children:[(0,s.jsxs)("span",{children:["#",p]}),i.length>0&&(0,s.jsx)("button",{onClick:()=>{x(!v)},children:(0,s.jsx)(u(),{alt:"users",src:c,height:30})}),v?(0,s.jsx)("div",{className:"userlist",children:i.map((e,t)=>(0,s.jsx)("div",{children:e.username},t))}):""]}),(0,s.jsx)("div",{className:"chatmessages",ref:_,children:null==m?void 0:m.map((e,t)=>(0,s.jsxs)("div",{className:e.username===o?"message":"sentmessage",children:[(0,s.jsx)("div",{children:e.message}),(0,s.jsxs)("span",{children:[e.time," : ",e.username===o?"Me":e.username," "]})]},t))}),(0,s.jsxs)("div",{className:"chatfooter",children:[(0,s.jsx)("input",{type:"text",onKeyDown:b,value:h,onChange:e=>j(e.target.value)}),(0,s.jsx)("button",{onClick:b,children:(0,s.jsx)(u(),{alt:"send",src:l,height:25})})]})]})};let v=r.lazy(()=>n.e(269).then(n.bind(n,5269))),x="",p="";var _=()=>{let[e,t]=(0,r.useState)(null),[n,o]=(0,r.useState)(!1),[a,l]=(0,r.useState)(""),[c,m]=(0,r.useState)(void 0),[u,d]=(0,r.useState)(!1),[g,h]=(0,r.useState)(!1),[f,_]=(0,r.useState)([]);return(0,r.useEffect)(()=>(null==e||e.on("new_join",e=>{console.log(e),_(e)}),null==e||e.on("send_room",e=>{localStorage.setItem("room",e.room),h(!1),o(!0)}),null==e||e.on("undefined_room",()=>{h(!1)}),null==e||e.on("initial_connection",e=>{console.log(x=e)}),null===e&&t((0,i.io)("https://chat-app-r3il.onrender.com",{autoConnect:!1})),()=>{null==e||e.disconnect(),localStorage.removeItem("room")}),[e]),(0,r.useEffect)(()=>{console.log(f)},[f]),(0,s.jsxs)(s.Fragment,{children:[!n&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"error",children:u?"You have not entered a username":"â€Ž"}),(0,s.jsx)("input",{placeholder:"Enter your username",style:u?{border:"2px solid red",outline:"none"}:{},className:"username",type:"text",value:a,onChange:e=>{l(e.target.value),u&&d(!1)}}),(0,s.jsx)(v,{joinRoomHandler:function(t,n){if("Enter"===t.key){if(!a){d(!0);return}let n=t.target.value;e.connect(),e.emit("join_room",{room:n.toUppercase(),username:a}),h(!0)}else if(n){if(!a){d(!0);return}let n=t.current.value;e.connect(),e.emit("join_room",{room:n.toUppercase(),username:a}),h(!0)}},createRoomHandler:function(t){if("submit"===t.target.type){if(!a){d(!0);return}p="";let n="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",s=n.length;for(let e=0;e<5;e++)p+=n.charAt(Math.floor(Math.random()*s));console.log(p),localStorage.setItem("room",p),h(!0),e.connect(),e.emit("create_room",p),e.emit("join_room",{room:p,username:a}),m(t.target.value)}}}),g&&(0,s.jsx)("span",{className:"loading",children:"Connection is being established. First time connections may take a bit longer."})]}),n&&(0,s.jsx)(j,{socket:e,userID:x,username:a,firstMessage:c,userList:f})]})};function b(){return(0,s.jsx)("main",{className:a().main,children:(0,s.jsx)(_,{})})}},7510:function(){},364:function(){},1192:function(e){e.exports={main:"page_main__GlU4n"}}},function(e){e.O(0,[101,971,596,744],function(){return e(e.s=2677)}),_N_E=e.O()}]);